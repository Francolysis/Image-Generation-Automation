<INSERT_FULL FINAL CODE FROM EARLIER UPDATE HERE>